<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ä°sme Ã–zel DoÄŸum GÃ¼nÃ¼ ÅžarkÄ±larÄ±</title>
  <link rel="stylesheet" href="style.css?v=4" />
</head>
<body>
  <h1>ðŸŽ‚ Ä°sme Ã–zel DoÄŸum GÃ¼nÃ¼ ÅžarkÄ±larÄ±</h1>

  <input type="text" id="search" placeholder="Ä°smini yaz..." autocomplete="off" />
  <ul id="results"></ul>

  <!-- PaylaÅŸÄ±m barÄ± (video Ã¼stÃ¼nde) -->
  <div id="share" class="share-bar" aria-label="PaylaÅŸ"></div>

  <div id="player" class="player"></div>

  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script>
    let fuse, names = [];
    let currentVideoUrl = null;     // orijinal (paylaÅŸÄ±m iÃ§in)
    const siteBase = location.href.replace(/#.*$/, '');

    // --- YouTube URL normalizasyonu (embed iÃ§in) ---
    function toEmbedUrl(url) {
      if (!url) return null;
      url = url.trim();

      // Zaten embed ise
      if (/youtube\.com\/embed\//.test(url)) return url;

      // youtu.be/VIDEO
      let m = url.match(/youtu\.be\/([A-Za-z0-9_-]{6,})/);
      if (m) return `https://www.youtube.com/embed/${m[1]}?rel=0&modestbranding=1`;

      // youtube.com/shorts/VIDEO
      m = url.match(/youtube\.com\/shorts\/([A-Za-z0-9_-]{6,})/);
      if (m) return `https://www.youtube.com/embed/${m[1]}?rel=0&modestbranding=1`;

      // youtube.com/watch?v=VIDEO (v parametresi)
      m = url.match(/[?&]v=([A-Za-z0-9_-]{6,})/);
      if (m) return `https://www.youtube.com/embed/${m[1]}?rel=0&modestbranding=1`;

      // BaÅŸka varyasyonlar iÃ§in son Ã§are: ID gibi gÃ¶rÃ¼nen son segmenti dener
      m = url.match(/([A-Za-z0-9_-]{6,})$/);
      if (m) return `https://www.youtube.com/embed/${m[1]}?rel=0&modestbranding=1`;

      return null;
    }

    // PaylaÅŸ barÄ±
    function buildShareBar() {
      const wrap = document.getElementById('share');
      wrap.innerHTML = `
        <a id="share-wa" class="btn wa" target="_blank">WhatsApp</a>
        <a id="share-fb" class="btn fb" target="_blank">Facebook</a>
        <a id="share-x"  class="btn x"  target="_blank">X (Twitter)</a>
        <a id="share-ig" class="btn ig" target="_blank">Instagram</a>
        <a id="share-cp" class="btn copy">Kopyala</a>
      `;
      document.getElementById('share-cp').addEventListener('click', e=>{
        e.preventDefault();
        const toCopy = currentVideoUrl || siteBase;
        navigator.clipboard.writeText(toCopy);
      });
      updateShareLinks();
    }

    function updateShareLinks() {
      const url = currentVideoUrl || siteBase;
      const encU = encodeURIComponent(url);
      const encT = encodeURIComponent("ðŸŽ‚ Ä°sme Ã¶zel doÄŸum gÃ¼nÃ¼ ÅŸarkÄ±sÄ±");
      document.getElementById('share-wa').href = `https://wa.me/?text=${encT}%20${encU}`;
      document.getElementById('share-fb').href = `https://www.facebook.com/sharer/sharer.php?u=${encU}`;
      document.getElementById('share-x').href  = `https://twitter.com/intent/tweet?text=${encT}&url=${encU}`;
      document.getElementById('share-ig').href = `https://www.instagram.com/?url=${encU}`;
    }

    async function loadNames() {
      const res = await fetch('names.json', { cache: 'no-store' });
      names = await res.json();
      fuse = new Fuse(names, { keys: ['name'], threshold: 0.3, ignoreLocation: true });
    }

    function renderResults(items) {
      const ul = document.getElementById('results');
      ul.innerHTML = '';
      if (!items.length) {
        ul.innerHTML = '<li class="nores">SonuÃ§ bulunamadÄ±</li>';
        return;
      }
      items.forEach(({ item }) => {
        const li = document.createElement('li');
        li.textContent = item.name;
        li.className = 'result';
        li.onclick = () => play(item);
        ul.appendChild(li);
      });
    }

    function play(item) {
      currentVideoUrl = item.youtube_url;              // paylaÅŸÄ±mda orijinal URL
      const embed = toEmbedUrl(item.youtube_url);      // iframe iÃ§in dÃ¶nÃ¼ÅŸtÃ¼r
      const player = document.getElementById('player');
      if (embed) {
        player.innerHTML =
          `<iframe width="560" height="315" src="${embed}"
             title="${item.name}" frameborder="0"
             allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
             allowfullscreen></iframe>`;
      } else {
        player.innerHTML = `<p style="color:#b00">Video URLâ€™si geÃ§ersiz gÃ¶rÃ¼nÃ¼yor.</p>`;
      }
      updateShareLinks();
    }

    let tId;
    function onSearchInput(e) {
      const q = e.target.value.trim();
      clearTimeout(tId);
      tId = setTimeout(() => {
        if (!q) { document.getElementById('results').innerHTML=''; return; }
        renderResults(fuse.search(q, { limit: 10 }));
      }, 120);
    }
    function onSearchEnter(e) {
      if (e.key==='Enter') {
        const q = e.target.value.trim();
        if (!q) return;
        const result = fuse.search(q, { limit: 1 });
        if (result.length) play(result[0].item);
      }
    }

    buildShareBar();
    loadNames();
    document.getElementById('search').addEventListener('input', onSearchInput);
    document.getElementById('search').addEventListener('keydown', onSearchEnter);
  </script>
</body>
</html>
