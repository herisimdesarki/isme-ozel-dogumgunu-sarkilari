<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>İsme Özel Doğum Günü Şarkıları</title>

  <!-- SEO -->
  <meta name="description" content="İsmini yaz, sana özel doğum günü şarkısını bul, YouTube videosunu aç ve tek tıkla paylaş!" />
  <link rel="canonical" href="https://herisimdesarki.github.io/isme-ozel-dogumgunu-sarkilari/" />

  <!-- Stil -->
  <link rel="stylesheet" href="style.css?v=5" />

  <!-- Fuse.js (bulanık arama) -->
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
</head>
<body>
  <header class="container">
    <h1>🎂 İsme Özel Doğum Günü Şarkıları</h1>
    <p class="lead">İsmini yaz → videoyu aç → tek tıkla paylaş 🎉</p>

    <input id="search" type="text" placeholder="İsmini yaz..." autocomplete="off" />
  </header>

  <main class="container">
    <!-- Sonuçlar -->
    <section>
      <div id="grid" class="grid"></div>
    </section>

    <!-- Oynatıcı kartı -->
    <section id="player"></section>
  </main>

  <footer class="container footnote">
    <small>© <span id="yil"></span> İsme Özel Şarkılar</small>
  </footer>

<script>
/* -------------------- Yardımcılar -------------------- */
const N = (sel, root=document) => root.querySelector(sel);

function toEmbed(raw) {
  if (!raw) return '';
  let url = raw.trim();

  // shorts -> watch
  url = url.replace(/youtube\.com\/shorts\/([\w-]+)/, 'youtube.com/watch?v=$1');

  // youtu.be -> watch
  url = url.replace(/youtu\.be\/([\w-]+)/, 'www.youtube.com/watch?v=$1');

  // watch?v= -> embed
  url = url.replace(/watch\?v=/, 'embed/');

  // parametreleri sadeleştir
  const u = new URL(url, 'https://www.youtube.com');
  const base = u.origin + u.pathname;
  return base + (base.includes('/embed/') ? '?rel=0' : '');
}

function shareText(name, link) {
  return `🎂 ${name} için doğum günü şarkısı:\n${link}\n#dogumgunu #ismeozel`;
}

function buildShareLinks(name, yt) {
  const text = encodeURIComponent(shareText(name, yt));
  const url  = encodeURIComponent(yt);

  const wa = `https://wa.me/?text=${text}`;
  const fb = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
  const tw = `https://twitter.com/intent/tweet?text=${text}`;
  // Instagram'ın web paylaşımı yok; profil açtırıyoruz (kullanıcı düzenleyebilir)
  const ig = `https://www.instagram.com/`;

  return `
    <div class="share-row">
      <a class="btn wa" href="${wa}" target="_blank" rel="noopener">WhatsApp</a>
      <a class="btn fb" href="${fb}" target="_blank" rel="noopener">Facebook</a>
      <a class="btn tw" href="${tw}" target="_blank" rel="noopener">X</a>
      <a class="btn ig" href="${ig}" target="_blank" rel="noopener">Instagram</a>
      <button class="btn ghost" onclick="copyShare('${encodeURIComponent(shareText(name, yt))}')">📋 Kopyala</button>
    </div>
  `;
}

async function copyShare(encoded) {
  const txt = decodeURIComponent(encoded);
  try {
    await navigator.clipboard.writeText(txt);
    alert('Paylaşım metni kopyalandı!');
  } catch {
    // iOS fallback
    const ta = document.createElement('textarea');
    ta.value = txt;
    document.body.appendChild(ta);
    ta.select(); document.execCommand('copy');
    ta.remove();
    alert('Paylaşım metni kopyalandı!');
  }
}

/* -------------------- Veri & Arama -------------------- */
let NAMES = [];
let fuse;

async function loadNames() {
  const res = await fetch('names.json', { cache: 'no-store' });
  NAMES = await res.json();

  fuse = new Fuse(NAMES, {
    keys: ['name'],
    threshold: 0.3,
    ignoreLocation: true,
    distance: 100,
    isCaseSensitive: false
  });

  // İlk yüklemede grid boş olsun
  renderGrid([]);

  // URL parametresi ile otomatik seçim
  const urlName = new URLSearchParams(location.search).get('name');
  if (urlName) {
    N('#search').value = urlName;
    selectName(urlName, false);
  }
}

function renderGrid(items) {
  const grid = N('#grid');
  grid.innerHTML = '';

  if (!items.length) return;

  items.forEach(({ item }) => {
    const card = document.createElement('a');
    card.className = 'card link';
    card.href = 'javascript:void(0)';
    card.innerHTML = `
      <div class="card-title">${item.name}</div>
      <div class="card-sub">YouTube’a git</div>
    `;
    card.onclick = () => selectName(item.name, true);
    grid.appendChild(card);
  });
}

/* -------------------- Seçim + Oynatıcı + Kaydırma -------------------- */
function selectName(name, pushUrl=false) {
  const hit = NAMES.find(n => (n.name || '').toLowerCase() === name.toLowerCase());
  if (!hit) return;

  if (pushUrl) {
    const newUrl = location.pathname + '?name=' + encodeURIComponent(hit.name);
    history.pushState({ name: hit.name }, '', newUrl);
  }

  const yt = hit.youtube || hit.youtube_url;
  const embed = toEmbed(yt);
  const player = N('#player');
  player.innerHTML = `
    <div class="card" id="playerCard">
      <div class="title-row">
        <h2>🎵 ${hit.name} için Doğum Günü Şarkısı</h2>
        ${buildShareLinks(hit.name, yt)}
      </div>
      <div class="video-wrap">
        <iframe loading="lazy" src="${embed}"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen title="${hit.name}"></iframe>
      </div>
    </div>
  `;

  // Mobilde videoya yumuşak kaydır
  setTimeout(() => {
    const el = N('#playerCard') || player;
    const y = el.getBoundingClientRect().top + window.pageYOffset - 12;
    window.scrollTo({ top: y, behavior: 'smooth' });
  }, 50);
}

/* -------------------- Olaylar -------------------- */
let tId;
N('#search').addEventListener('input', (e) => {
  const q = e.target.value.trim();
  clearTimeout(tId);
  tId = setTimeout(() => {
    if (!q) { renderGrid([]); return; }
    const res = fuse.search(q, { limit: 20 });
    renderGrid(res);
  }, 120);
});

N('#search').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    const q = e.target.value.trim();
    if (!q) return;
    const [first] = fuse.search(q, { limit: 1 });
    if (first) selectName(first.item.name, true);
  }
});

/* -------------------- Başlat -------------------- */
N('#yil').textContent = new Date().getFullYear();
loadNames();
</script>
</body>
</html>
