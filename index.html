<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ä°sme Ã–zel DoÄŸum GÃ¼nÃ¼ ÅžarkÄ±larÄ±</title>
  <link rel="stylesheet" href="style.css?v=3" />
</head>
<body>
  <h1>ðŸŽ‚ Ä°sme Ã–zel DoÄŸum GÃ¼nÃ¼ ÅžarkÄ±larÄ±</h1>

  <input type="text" id="search" placeholder="Ä°smini yaz..." autocomplete="off" />
  <ul id="results"></ul>

  <div id="player" style="margin-top:16px;"></div>

  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script>
    let fuse, names = [];

    // YouTube url -> embed url dÃ¶nÃ¼ÅŸtÃ¼r
    function toEmbed(u) {
      try {
        if (!u) return "";
        u = u.trim();

        // BazÄ± Evernote kopyalarÄ±nda boÅŸluklar, parametreler olabiliyor
        // youtu.be -> watch?v= normalleÅŸtir
        if (u.includes("youtu.be/")) {
          const id = u.split("youtu.be/")[1].split(/[?&]/)[0].trim();
          return `https://www.youtube.com/embed/${id}`;
        }

        const url = new URL(u.replace("youtube.com/shorts/", "youtube.com/watch?v="));

        // shorts veya watch?v=
        let id = url.searchParams.get("v");
        if (!id) {
          // /embed/ID veya /shorts/ID gibi durumlar iÃ§in path'ten al
          const m = url.pathname.match(/\/(embed|shorts)\/([^/?#]+)/);
          if (m) id = m[2];
        }
        if (!id) {
          // Son Ã§are: path'in son parÃ§asÄ±
          id = url.pathname.split("/").pop();
        }
        return `https://www.youtube.com/embed/${id}`;
      } catch (e) {
        console.warn("Embed'e Ã§evrilemedi:", u, e);
        return "";
      }
    }

    async function loadNames() {
      try {
        const res = await fetch('names.json', { cache: 'no-store' });
        const raw = await res.json();

        // JSON: [{ name, youtube_url }]
        // veriyi normalize et + embed link hazÄ±rla
        names = raw
          .map(r => ({
            name: (r.name || "").trim(),
            embed: toEmbed(r.youtube_url)
          }))
          .filter(x => x.name && x.embed);

        fuse = new Fuse(names, {
          keys: ['name'],
          threshold: 0.3,
          ignoreLocation: true,
          isCaseSensitive: false,
          distance: 100
        });
      } catch (e) {
        console.error('names.json yÃ¼klenemedi:', e);
      }
    }

    function renderResults(items) {
      const ul = document.getElementById('results');
      ul.innerHTML = '';

      if (!items || items.length === 0) {
        const li = document.createElement('li');
        li.textContent = 'SonuÃ§ bulunamadÄ±';
        li.style.color = '#666';
        ul.appendChild(li);
        return;
      }

      items.forEach(({ item }) => {
        const li = document.createElement('li');
        li.textContent = item.name;
        li.style.cursor = 'pointer';
        li.onclick = () => {
          document.getElementById('player').innerHTML =
            `<iframe width="560" height="315" src="${item.embed}"
               title="${item.name}" frameborder="0"
               allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
               allowfullscreen></iframe>`;
        };
        ul.appendChild(li);
      });
    }

    let tId;
    function onSearchInput(e) {
      const q = e.target.value.trim();
      clearTimeout(tId);
      tId = setTimeout(() => {
        if (!q) {
          document.getElementById('results').innerHTML = '';
          document.getElementById('player').innerHTML = '';
          return;
        }
        const result = fuse.search(q, { limit: 10 });
        renderResults(result);
      }, 120);
    }

    function onSearchEnter(e) {
      if (e.key === 'Enter') {
        const q = e.target.value.trim();
        if (!q) return;
        const result = fuse.search(q, { limit: 1 });
        if (result.length) {
          const first = result[0].item;
          document.getElementById('player').innerHTML =
            `<iframe width="560" height="315" src="${first.embed}"
               title="${first.name}" frameborder="0"
               allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
               allowfullscreen></iframe>`;
        }
      }
    }

    document.getElementById('search').addEventListener('input', onSearchInput);
    document.getElementById('search').addEventListener('keydown', onSearchEnter);

    loadNames();
  </script>
</body>
</html>
