<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>İsme Özel Doğum Günü Şarkıları</title>
  <link rel="stylesheet" href="style.css?v=5" />
  <style>
    /* Sayfa genişliği ve merkezleme */
    .container {
      max-width: 820px;
      margin: 0 auto;
      padding: 16px;
    }

    /* Paylaş çubuğu */
    #share { display:none; }
    .share-wrap {
      display:flex;
      justify-content:center;   /* ORTALA */
      margin: 12px 0 2px;
    }
    .share-buttons {
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;   /* ORTALA */
    }
    .share-buttons a,
    .share-buttons button {
      padding: 6px 12px;
      border-radius: 6px;
      color: #fff;
      font-size: 14px;
      font-weight: 700;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: none;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,.12);
    }
    .whatsapp { background:#25D366; }
    .facebook { background:#1877F2; }
    .twitter  { background:#000; }
    .instagram {
      background: linear-gradient(45deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888);
    }
    .copy { background:#666; }

    /* Player’ı da ortaya ve esnek yap */
    #player { display:flex; justify-content:center; }
    .video {
      width: 100%;
      max-width: 800px;
      aspect-ratio: 16 / 9;
      border:0;
      border-radius:12px;
      box-shadow: 0 6px 18px rgba(0,0,0,.18);
    }

    /* Listeyi ve input’u ortalı görünür yap */
    #results {
      max-width: 800px;
      margin: 10px auto 0;
    }
    #search {
      max-width: 800px;
      width: 100%;
      margin: 0 auto 8px;
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🎂 İsme Özel Doğum Günü Şarkıları</h1>

    <input type="text" id="search" placeholder="İsmini yaz..." autocomplete="off" />
    <ul id="results"></ul>

    <!-- Paylaş butonları (video üstünde ve ortalı) -->
    <div id="share" class="share-wrap">
      <div class="share-buttons">
        <a id="share-whatsapp" class="whatsapp" target="_blank" rel="noopener">📱 WhatsApp</a>
        <a id="share-facebook" class="facebook" target="_blank" rel="noopener">📘 Facebook</a>
        <a id="share-twitter" class="twitter" target="_blank" rel="noopener">🐦 X</a>
        <a href="#" class="instagram" onclick="shareInstagram()">📷 Instagram</a>
        <button class="copy" onclick="copyLink()">🔗 Kopyala</button>
      </div>
    </div>

    <div id="player" style="margin-top:10px;"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script>
    let fuse, names = [];
    let currentUrl = "";

    async function loadNames() {
      try {
        const res = await fetch('names.json', { cache: 'no-store' });
        names = await res.json();
        fuse = new Fuse(names, {
          keys: ['name'],
          threshold: 0.3,
          ignoreLocation: true,
          isCaseSensitive: false,
          distance: 100
        });
      } catch (e) {
        console.error('names.json yüklenemedi:', e);
      }
    }

    function toEmbed(url) {
      if (!url) return "";
      try {
        if (url.includes("youtube.com/shorts/")) {
          const id = url.split("/shorts/")[1].split(/[?&]/)[0];
          return `https://www.youtube.com/embed/${id}`;
        } else if (url.includes("youtu.be/")) {
          const id = url.split("youtu.be/")[1].split(/[?&]/)[0];
          return `https://www.youtube.com/embed/${id}`;
        } else if (url.includes("watch?v=")) {
          const id = new URL(url).searchParams.get("v");
          return `https://www.youtube.com/embed/${id}`;
        }
      } catch (_) {}
      return "";
    }

    function showShareButtons(url, name) {
      const encUrl = encodeURIComponent(url);
      const encText = encodeURIComponent(`🎂 ${name} için doğum günü şarkısı:`);
      document.getElementById("share-whatsapp").href =
        `https://api.whatsapp.com/send?text=${encText}%20${encUrl}`;
      document.getElementById("share-facebook").href =
        `https://www.facebook.com/sharer/sharer.php?u=${encUrl}`;
      document.getElementById("share-twitter").href =
        `https://twitter.com/intent/tweet?text=${encText}&url=${encUrl}`;
    }

    function copyLink() {
      if (!currentUrl) return;
      navigator.clipboard.writeText(currentUrl).then(() => {
        alert("🔗 Link kopyalandı!");
      });
    }

    function shareInstagram() {
      alert("📷 Instagram doğrudan link paylaşımı desteklemiyor. Kopyaladığınız linki DM veya hikayede yapıştırabilirsiniz.");
    }

    function playItem(item) {
      currentUrl = String(item.youtube_url || "").trim();
      const embed = toEmbed(currentUrl);

      if (!embed) {
        document.getElementById('player').innerHTML =
          `<div style="color:#b00">Bu link gömülemedi. <a href="${currentUrl}" target="_blank" rel="noopener">YouTube'da aç</a>.</div>`;
        document.getElementById('share').style.display = currentUrl ? 'flex' : 'none';
        return;
      }

      showShareButtons(currentUrl, item.name);

      document.getElementById('player').innerHTML =
        `<iframe class="video"
           src="${embed}"
           title="${item.name}" frameborder="0"
           allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
           allowfullscreen referrerpolicy="strict-origin-when-cross-origin"></iframe>`;

      document.getElementById('share').style.display = 'flex';
    }

    function renderResults(items) {
      const ul = document.getElementById('results');
      ul.innerHTML = '';
      if (!items || items.length === 0) {
        const li = document.createElement('li');
        li.textContent = 'Sonuç bulunamadı';
        li.style.color = '#666';
        ul.appendChild(li);
        return;
      }
      items.forEach(({ item }) => {
        const li = document.createElement('li');
        li.textContent = item.name;
        li.style.cursor = 'pointer';
        li.onclick = () => playItem(item);
        ul.appendChild(li);
      });
    }

    let tId;
    function onSearchInput(e) {
      const q = e.target.value.trim();
      clearTimeout(tId);
      tId = setTimeout(() => {
        if (!q) {
          document.getElementById('results').innerHTML = '';
          document.getElementById('player').innerHTML = '';
          document.getElementById('share').style.display = 'none';
          return;
        }
        const result = fuse.search(q, { limit: 10 });
        renderResults(result);
      }, 120);
    }

    function onSearchEnter(e) {
      if (e.key === 'Enter') {
        const q = e.target.value.trim();
        if (!q) return;
        const result = fuse.search(q, { limit: 1 });
        if (result.length) playItem(result[0].item);
      }
    }

    document.getElementById('search').addEventListener('input', onSearchInput);
    document.getElementById('search').addEventListener('keydown', onSearchEnter);

    loadNames();
  </script>
</body>
</html>
